I"<h1 id="descripci칩n-general-cat치logo-de-im치genes-satelitales-a-escala-regional">Descripci칩n general: Cat치logo de im치genes satelitales a escala regional</h1>
<p>La mayor칤a de los productos satelitales se dividen en bloques para su distribuci칩n. Los datos globales de Landsat se dividen en escenas de ~180 km<sup>2</sup>, con identificadores 칰nicos de path/row. <em><a href="https://www.sciencedirect.com/science/article/abs/pii/S0034425715302194" target="_blank">Wulder et al. (2016)</a></em> sugieren  que cada escena es fotografiada cada 16 d칤as por Landsat 8 y cada 16 d칤as por Landsat 7 (aproximadamente 45 veces al a침o). Los bordes de cada trayectoria se superponen, proporcionando una mayor frecuencia temporal en estas 치reas. Sin embargo, los cielos nublados durante el paso de los sat칠lites y otras anomal칤as de adquisici칩n hacen que ciertas escenas o p칤xeles sean inutilizables.</p>

<p><img src="../fig/03_worldLandsat.png" width="100%" height="100%" />
<sub><em>USGS Landsat archive holdings as of January 1, 2015 (Wulder et al. (2016)).</em></sub>
<!--
<img src="https://3c1703fe8d.site.internapcdn.net/newman/gfx/news/hires/2013/76fuygfd.gif" width="100%" height="100%" />
<sub>*Forest loss in Sumatra's Riau province, Indonesia, 2000-2012. Credit: Hansen, Potapov, Moore, Hancher et al., 2013*</sub>
-->
<br />
<!--**455 escenas de Landsat cubren los Estados Unidos:**-->
<br />
<img src="../fig/03_MeanderCutTumbesRiver.gif" border="10" />
<br /><br /></p>

<p><br />
<!--**455 escenas de Landsat cubren los Estados Unidos:**-->
<br />
<img src="../fig/03_IlegalMiningAndMeanderMigration.gif" border="10" />
<br /><br /></p>

<p>Para la mayor칤a de las aplicaciones a escala regional, se tendr치 que combinar m칰ltiples im치genes de sat칠lite para cubrir completamente su extensi칩n espacial y completar los datos faltantes causados por las nubes, etc. Google Earth Engine (GEE) es particularmente adecuado para estas tareas.</p>

<!--

# Ejericio: Flujo b치sico de trabajo GEE
Aqu칤, aprovecharemos GEE para crear un composite que represente el pico de la temporada de crecimiento de cultivos para una cuenca de inter칠s.


### Image Collections
Una pila o serie temporal de im치genes se llaman `Image Collections`. Cada fuente de datos disponible en GEE tiene su propia Image Collection y su propio ID (por ejemplo, el [Landsat 5 SR collection](https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LT05_C01_T1_SR), o la [GRIDMET meteorological data collection](https://code.earthengine.google.com/dataset/IDAHO_EPSCOR/GRIDMET)). Tambi칠n se puede crear Image Collection a partir de im치genes individuales o fusionar colecciones existentes. Puede encontrar m치s informaci칩n sobre las Image Collection [here in the GEE Developer's Guide](https://developers.google.com/earth-engine/ic_creating).

Para generar im치genes que cubran grandes 치reas espaciales y para llenar los huecos de imagen debidos a las nubes, etc., podemos cargar una `ImageCollection` completa, pero filtrar la colecci칩n para devolver s칩lo los per칤odos de tiempo o las ubicaciones espaciales que sean de inter칠s. Hay filtros de acceso directo para los que se utilizan com칰nmente (imageCollection.filterDate(), imageCollection.filterBounds()...), pero pueden utilizarse la mayor칤a de los filtros de la secci칩n `ee.Filter()` de la pesta침a Docs. M치s informaci칩n sobre [filters on the Developer's Guide](https://developers.google.com/earth-engine/ic_filtering).

### Cargar archivos vectoriales
Trabajaremos en la creaci칩n de un composite para una cuenca de los EE.UU. La forma m치s f치cil de filtrar una ubicaci칩n irregular sin tener que identificar las rutas y filas de los mosaicos de la imagen satelital es usar un pol칤gono vectorial.

Hay tres maneras de obtener datos de vectores en GEE:

  * [Cargar un shapefile](https://developers.google.com/earth-engine/importing) directamente a su carpeta personal *Asset* en el panel superior izquierdo. Puedes crear subcarpetas y establecer permisos para compartir seg칰n sea necesario. Utilizamos un archivo vectorial Asset en el [modulo Accediendo al cat치logo de im치genes de sat칠lite](https://hasencios.github.io/GEE_BASICO_SENAMHI/03-load-imagery/).
  * Utilizar un conjunto de datos de vectores existente en GEE. [Navegue por el cat치logo de datos vectoriales aqu칤](https://developers.google.com/earth-engine/vector_datasets).
  * Dibuje manualmente puntos, l칤neas y pol칤gonos usando las herramientas de geometr칤a del Code Editor. Haremos esto en el [Modulo de Clasificaci칩n Supervisada de Im치genes de Sat칠lite](https://hasencios.github.io/GEE_BASICO_SENAMHI/05-classify-imagery/).

Aqu칤, usaremos un activo vectorial existente, el [USGS Watershed Boundaries - HUC12](https://code.earthengine.google.com/dataset/USGS/WBD/2017/HUC12)

Para cargar un archivo vectorial de sus Assets en su espacio de trabajo, necesitamos usar el "filepath" y lanzarlo a un tipo de datos `ee.FeatureCollection`. Lee m치s aqu칤: ["Managing Assets" in the Developer's Guide](https://developers.google.com/earth-engine/asset_manager#importing-assets-to-your-script).


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// cargar un pol칤gono de l칤mite de cuenca (una base de datos vectorial p칰blica ya en GEE)</span>
<span class="c1">// nota: v칠ase el tutorial mencionado arriba para obtener orientaci칩n sobre la importaci칩n de bases de datos de vectores</span>
<span class="kd">var</span> <span class="nx">watersheds</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">FeatureCollection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users/hasencios/Cuencas_2012_gcs</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">watersheds</span><span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">watersheds</span><span class="p">,</span> <span class="p">{},</span> <span class="dl">'</span><span class="s1">watersheds</span><span class="dl">'</span><span class="p">)</span></code></pre></figure>


<br>
<img src="../fig/03_wPeru.png" border = "10">
<br><br>

### La herramienta Inspector
La herramienta "Inspector" permite consultar las capas del mapa en un punto. Lo usaremos para ayudarnos a seleccionar una cuenca espec칤fica. Para usar la herramienta "Inspector", haga clic en la pesta침a "Inspector" en el panel superior derecho para activarla. Luego haga clic en cualquier lugar dentro del Visor de Mapas. Se mostrar치n las coordenadas de su clic, junto con el valor de las capas del mapa en ese punto.

Podemos usar esto para encontrar el atributo "name" de nuestra cuenca de inter칠s (춰elige la que quieras!).

<br>
<img src="../fig/03_inspectorN.png" border = "10">
<br><br>

Una vez que hayas determinado la propiedad "name" de tu cuenca, usa la funci칩n featureCollection.filterMetadata() para extraer esta cuenca de la base de datos completa.


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// use la herramienta del inspector para encontrar el nombre de una cuenca que le interese</span>
<span class="kd">var</span> <span class="nx">watershed</span> <span class="o">=</span> <span class="nx">watersheds</span><span class="p">.</span><span class="nx">filterMetadata</span><span class="p">(</span><span class="dl">'</span><span class="s1">NOMBRE</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">equals</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Cuenca Mantaro</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// imprima la metadata de la cuenca</span>
<span class="nx">print</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cuenca Mantaro</span><span class="dl">'</span><span class="p">,</span><span class="nx">watershed</span><span class="p">);</span>

<span class="c1">// establecer la vista del mapa y el zoom, y a침adir la l칤nea divisoria de aguas al mapa</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">centerObject</span><span class="p">(</span><span class="nx">watershed</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">watershed</span><span class="p">,{},</span><span class="dl">'</span><span class="s1">Cuencas Mantaro</span><span class="dl">'</span><span class="p">);</span></code></pre></figure>


Cuenca de inter칠s: Mantaro
<br>
<img src="../fig/03_mantaro.png" border = "10">
<br><br>


### Filtrar una Image Collection
Aqu칤, estamos seleccionando todas las im치genes en el [Landsat 8 Surface Reflectance collection](https://code.earthengine.google.com/dataset/LANDSAT/LC08/C01/T1_SR) adquirido sobre nuestra cuenca de inter칠s.

*Consejo: Los ID de las Image collection se encuentran en la barra de herramientas de "Search" en la parte superior del editor de c칩digos o a trav칠s de la b칰squeda en el [data archive](https://code.earthengine.google.com/datasets/).*


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// cargue todas las im치genes Landsat 8 SR dentro de los l칤mites del pol칤gono para el a침o 2017</span>
<span class="kd">var</span> <span class="nx">l8collection</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">ImageCollection</span><span class="p">(</span><span class="dl">'</span><span class="s1">LANDSAT/LC08/C01/T1_SR</span><span class="dl">'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">filterBounds</span><span class="p">(</span><span class="nx">watershed</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">filterDate</span><span class="p">(</span><span class="dl">'</span><span class="s1">2017-01-01</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">2017-12-31</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">l8collection</span><span class="p">);</span></code></pre></figure>


Imprimir nuestra colecci칩n filtrada en la consola nos dice cu치ntas im치genes hay en nuestro filtro (148) as칤 como los nombres de las bandas y las propiedades de las im치genes de nuestra colecci칩n:
<br>
<img src="../fig/03_collectionN.png" border = "10" width="50%" height="50%">
<br><br>

### Aplicar funciones
Como puedes ver al navegar por la pesta침a `Docs` en el panel superior izquierdo del Code Editor, hay funciones GEE espec칤ficas para los tipos de datos `Image` y `ImageCollection`. Hay muchas, incluyendo operadores matem치ticos y booleanos, convoluciones y estad칤sticas focales, y transformaciones espectrales y an치lisis de textura espacial. Navegue por la lista, o lea sobre las operaciones generales disponibles en el [GEE Developer's Guide "Image Overview"" section](https://developers.google.com/earth-engine/image_overview).

A menudo, queremos usar una funci칩n sobre cada imagen de una Image Collection. Para ello, necesitamos esencialmente "hacer un bucle" a trav칠s de cada imagen de la colecci칩n de im치genes. En GEE, los "bucles" se realizan con la funci칩n .map().


**Evitar los bucles reales a toda costa.** Usar un bucle for lleva la operaci칩n al navegador (mala pr치ctica). Usando imageCollection.map() env칤a la operaci칩n a los servidores de Google para las ejecuciones distribuidas (buena pr치ctica). Los bucles implementados de forma t칤pica para la sentencia for, llevan la operaci칩n al navegador, y no funcionan bien, si es que funciona.

Se puede encontrar m치s informaci칩n sobre la aplicaci칩n de funciones a las Image collection [here in the Developer's Guide](https://developers.google.com/earth-engine/ic_mapping).

El concepto .map() se aplica tambi칠n a las `featureCollections` - para aplicar una funci칩n a cada caracter칤stica de una colecci칩n, aplicamos esa funci칩n a trav칠s de la featureCollection con la featureCollection.map(). Ver ["Mapping over a Feature Collection"](https://developers.google.com/earth-engine/feature_collection_mapping) en la Gu칤a del Desarrollador.

### Enmascarar nubes
Aqu칤, haremos uso de la banda `pixel_qa` que se proporciona con los productos SR para enmascarar los p칤xeles con nubes, sombras de nubes y nieve. Enmascararemos los p칤xeles de la imagen bas치ndonos en el valor de pixel_qa.

Definimos expl칤citamente una nueva funci칩n llamada "maskClouds" y la aplicamos a cada imagen de la imageCollection utilizando `imageCollection.map()`. Las funciones necesitan expl칤citamente **return** la salida final.


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Enmascarar p칤xeles con nubes y sombras de nubes -------------------------------------</span>

<span class="c1">// Los productos de reflectancia superficial vienen con una banda 'pixel_qa'.</span>
<span class="c1">// que se basa en la cfmask. Lea m치s aqu칤:</span>
<span class="c1">// https://landsat.usgs.gov/landsat-surface-reflectance-quality-assessment</span>

<span class="c1">// crear la funci칩n de enmascarar nubes, sombras de nubes, nieve</span>
<span class="kd">var</span> <span class="nx">maskClouds</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">image</span><span class="p">){</span>
  <span class="c1">// make a new single band image from the pixel qa band</span>
  <span class="kd">var</span> <span class="nx">pixel_qa</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">pixel_qa</span><span class="dl">'</span><span class="p">);</span>
  <span class="c1">// keep clear (0) and water (1) pixels</span>
  <span class="k">return</span> <span class="nx">image</span><span class="p">.</span><span class="nx">updateMask</span><span class="p">(</span><span class="nx">pixel_qa</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="mi">322</span><span class="p">));</span>   
<span class="p">};</span>

<span class="c1">// usar "map" para aplicar la funci칩n a cada imagen de la colecci칩n</span>
<span class="kd">var</span> <span class="nx">l8masked</span> <span class="o">=</span> <span class="nx">l8collection</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">maskClouds</span><span class="p">);</span>

<span class="c1">// visualizar la primera imagen de la colecci칩n, antes y despu칠s de la m치scara</span>
<span class="kd">var</span> <span class="nx">visParams</span> <span class="o">=</span> <span class="p">{</span><span class="na">bands</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">B4</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">B3</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">B2</span><span class="dl">'</span><span class="p">],</span> <span class="na">min</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="na">max</span><span class="p">:</span> <span class="mi">2000</span><span class="p">}</span>

<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Image</span><span class="p">(</span><span class="nx">l8masked</span><span class="p">.</span><span class="nx">first</span><span class="p">()),</span> <span class="nx">visParams</span><span class="p">,</span> <span class="dl">'</span><span class="s1">clouds masked</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Image</span><span class="p">(</span><span class="nx">l8collection</span><span class="p">.</span><span class="nx">first</span><span class="p">()),</span> <span class="nx">visParams</span><span class="p">,</span> <span class="dl">'</span><span class="s1">original</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span></code></pre></figure>


<br>
<img src="../fig/03_maskedN.png" border = "10">
<br><br>

### Calcular el 칤ndice NDVI como una nueva banda
Del mismo modo, si queremos calcular el NDVI en cada imagen y a침adirlo como una nueva banda, tenemos que crear una funci칩n y mapearla sobre la colecci칩n. Aqu칤, usamos la funci칩n `normalizedDifference()`. [Mathematical Operations page in the GEE Developer's Guide](https://developers.google.com/earth-engine/image_math) proporciona m치s informaci칩n sobre c치lculos raster simples y complejos.


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// crear una funci칩n para a침adir el NDVI usando la banda NIR (B5) y roja (B4)</span>
<span class="kd">var</span> <span class="nx">getNDVI</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">img</span><span class="p">){</span>
  <span class="k">return</span> <span class="nx">img</span><span class="p">.</span><span class="nx">addBands</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">normalizedDifference</span><span class="p">([</span><span class="dl">'</span><span class="s1">B5</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">B4</span><span class="dl">'</span><span class="p">]).</span><span class="nx">rename</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">));</span>
<span class="p">};</span>

<span class="c1">// ejemplo extra: una funci칩n equivalente usando 치lgebra de mapas</span>
<span class="kd">var</span> <span class="nx">getNDVI2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">img</span><span class="p">){</span>
  <span class="k">return</span> <span class="nx">img</span><span class="p">.</span><span class="nx">addBands</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">B5</span><span class="dl">'</span><span class="p">).</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">B4</span><span class="dl">'</span><span class="p">))</span>
            <span class="p">.</span><span class="nx">divide</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">B5</span><span class="dl">'</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">B3</span><span class="dl">'</span><span class="p">))));</span>
<span class="p">};</span>

<span class="c1">// aplicar la funci칩n sobre la image collection</span>
<span class="kd">var</span> <span class="nx">l8ndvi</span> <span class="o">=</span> <span class="nx">l8masked</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getNDVI</span><span class="p">);</span>

<span class="c1">// imprime una imagen para ver que la banda est치 ahora all칤</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Image</span><span class="p">(</span><span class="nx">l8ndvi</span><span class="p">.</span><span class="nx">first</span><span class="p">()));</span></code></pre></figure>


### Crear un Composite "Greenest Pixel"
Ahora necesitamos reunir la Image Collection para crear una imagen continua a trav칠s de la cuenca. Hay varias opciones de mosaico/composici칩n disponibles, desde simples composiciones de valor m치ximo (`imageCollection.max()`) y mosaicos sencillos con la imagen m치s reciente (`imageCollection.mosaic()`).   [Compositing and Mosaicking page on the Developer's Guide](https://developers.google.com/earth-engine/ic_composite_mosaic) proporciona ejemplos de estos.

Aqu칤, usaremos la funci칩n `imageCollection.qualityMosaic()`. Al priorizar la imagen a utilizar en base a una banda espec칤fica, este m칠todo asegura que los valores de todas las bandas se tomen de la misma imagen. A cada p칤xel se le asignan los valores de la imagen con el valor m치s alto de la banda deseada.

Usaremos esto para hacer un "greenest pixel composite" para nuestra cuenca basado en la banda del NDVI que acabamos de calcular. La imagen compuesta final retendr치 todas las bandas en la entrada (a menos que especifiquemos lo contrario). Cada p칤xel en la imagen compuesta podr칤a potencialmente provenir de im치genes adquiridas en fechas diferentes, pero todas las bandas dentro de cada p칤xel son de la misma imagen. En general, esto proporciona la mejor instant치nea disponible del paisaje en el pico de la temporada de crecimiento, independientemente del momento fenol칩gico dentro del a침o.


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// para cada pixel, seleccione el "mejor" conjunto de bandas de las im치genes disponibles</span>
<span class="c1">// basado en el m치ximo NDVI/greenness</span>
<span class="kd">var</span> <span class="nx">composite</span> <span class="o">=</span> <span class="nx">l8ndvi</span><span class="p">.</span><span class="nx">qualityMosaic</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">).</span><span class="nx">clip</span><span class="p">(</span><span class="nx">watershed</span><span class="p">);</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">composite</span><span class="p">);</span>

<span class="c1">// Visualizar el NDVI</span>
<span class="kd">var</span> <span class="nx">ndviPalette</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">FFFFFF</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">CE7E45</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">DF923D</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">F1B555</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">FCD163</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">99B718</span><span class="dl">'</span><span class="p">,</span>
               <span class="dl">'</span><span class="s1">74A901</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">66A000</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">529400</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">3E8601</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">207401</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">056201</span><span class="dl">'</span><span class="p">,</span>
               <span class="dl">'</span><span class="s1">004C00</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">023B01</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">012E01</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">011D01</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">011301</span><span class="dl">'</span><span class="p">];</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">composite</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">),</span>
            <span class="p">{</span><span class="na">min</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="na">max</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">palette</span><span class="p">:</span> <span class="nx">ndviPalette</span><span class="p">},</span> <span class="dl">'</span><span class="s1">ndvi</span><span class="dl">'</span><span class="p">);</span></code></pre></figure>


El m치ximo anual de NDVI a trav칠s de esta cuenca hidrogr치fica destaca las zonas altoandinas con presencia de suelo desnudo y en las cercan칤as la selva, los m치s verdes :

<br>
<img src="../fig/03_ndviN.png" border = "10">
<br><br>

Tambi칠n podemos usar esta imagen compuesta para visualizar una composici칩n de color verdadero usando las bandas RGB:


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Visualizar el compuesto en color verdadero </span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">composite</span><span class="p">,</span> <span class="p">{</span><span class="na">bands</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">B4</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">B3</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">B2</span><span class="dl">'</span><span class="p">],</span> <span class="na">min</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">max</span><span class="p">:</span> <span class="mi">2000</span><span class="p">},</span> <span class="dl">'</span><span class="s1">true color composite</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></code></pre></figure>


<br>
<img src="../fig/03_tccN.png" border = "10">
<br><br>

### Visualizar los resultados en un gr치fico
Para ilustrar brevemente la capacidad de GEE de generar gr치ficos de datos, cargamos el producto de datos MODIS NDVI para trazar la serie temporal anual de NDVI medio de nuestra cuenca. La generaci칩n de gr치ficos tambi칠n est치 cubierto en el [m칩dulo 04 Reductores espaciales y temporales](https://hasencios.github.io/GEE_BASICO_SENAMHI/04-reducers/).


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Gr치fico de series temporales anuales del NDVI medio en la cuenca</span>
<span class="c1">// de nuestro compuesto calculado de Landsat 8</span>
<span class="kd">var</span> <span class="nx">chart</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">series</span><span class="p">({</span>
    <span class="na">imageCollection</span><span class="p">:</span> <span class="nx">l8ndvi</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">),</span>
    <span class="na">region</span><span class="p">:</span> <span class="nx">watershed</span><span class="p">,</span>
    <span class="na">reducer</span><span class="p">:</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Reducer</span><span class="p">.</span><span class="nx">mean</span><span class="p">(),</span>
    <span class="na">scale</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
<span class="p">})</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">chart</span><span class="p">)</span>  <span class="c1">//** Puede exportar la figura o los datos en la ventana</span>


<span class="c1">// Tambi칠n se puede comparar con el producto MODIS de 16 d칤as</span>

<span class="c1">// a침adir series temporales de sat칠lites: producto MODIS NDVI 250m de 16 d칤as</span>
<span class="kd">var</span> <span class="nx">modis</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">ImageCollection</span><span class="p">(</span><span class="dl">'</span><span class="s1">MODIS/006/MOD13Q1</span><span class="dl">'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">filterBounds</span><span class="p">(</span><span class="nx">watershed</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">filterDate</span><span class="p">(</span><span class="dl">'</span><span class="s1">2017-01-01</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">2017-12-31</span><span class="dl">'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Gr치fico de series temporales anuales del NDVI medio en la cuenca</span>
<span class="c1">// del producto suavizado MODIS 16 d칤as</span>
<span class="kd">var</span> <span class="nx">chart</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">series</span><span class="p">({</span>
    <span class="na">imageCollection</span><span class="p">:</span> <span class="nx">modis</span><span class="p">,</span>
    <span class="na">region</span><span class="p">:</span> <span class="nx">watershed</span><span class="p">,</span>
    <span class="na">reducer</span><span class="p">:</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Reducer</span><span class="p">.</span><span class="nx">mean</span><span class="p">(),</span>
    <span class="na">scale</span><span class="p">:</span> <span class="mi">250</span>
<span class="p">})</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">chart</span><span class="p">)</span></code></pre></figure>


Tenga en cuenta que puede exportar los datos subyacentes del gr치fico mediante el icono de la flecha que aparece...
<br>
<img src="../fig/03_chartN.png" border = "10" width="90%" height="90%">
<br><br>

### Exportar los resultados como una Table
La manera m치s eficiente de obtener datos de GEE es en una tabla. Esta forma tiene el beneficio de estar codificada y por lo tanto ser totalmente reproducible. Exportar tablas tambi칠n requiere mucha menos potencia de c치lculo que exportar una imagen completa. Cuando realices un an치lisis, piensa bien en c칩mo puedes dejar el raster en la nube y extraer los datos que necesitas como una matriz.


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Use los botones de la tabla emergente para exportar el .csv, o puede hacer un gui칩n</span>
<span class="c1">// la exportaci칩n como sigue utilizando un reductor:</span>

<span class="c1">// obtener el valor medio de la regi칩n de cada imagen</span>
<span class="kd">var</span> <span class="nx">ts</span> <span class="o">=</span> <span class="nx">modis</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">image</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">system:time_start</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">mean</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">reduceRegion</span><span class="p">({</span>
    <span class="na">reducer</span><span class="p">:</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Reducer</span><span class="p">.</span><span class="nx">mean</span><span class="p">(),</span>
    <span class="na">geometry</span><span class="p">:</span> <span class="nx">watershed</span><span class="p">,</span>
    <span class="na">scale</span><span class="p">:</span> <span class="mi">250</span>
  <span class="p">});</span>
  <span class="c1">// y devuelve una caracter칤stica con geometr칤a 'null' con propiedades (dictionary)  </span>
  <span class="k">return</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">mean</span><span class="dl">'</span><span class="p">:</span> <span class="nx">mean</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">),</span>
                            <span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">:</span> <span class="nx">date</span><span class="p">})</span>
<span class="p">});</span>

<span class="c1">// Exportar una tabla de fecha .csv, media NDVI para la cuenca</span>
<span class="nx">Export</span><span class="p">.</span><span class="nx">table</span><span class="p">.</span><span class="nx">toDrive</span><span class="p">({</span>
  <span class="na">collection</span><span class="p">:</span> <span class="nx">ts</span><span class="p">,</span>
  <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENAMHI_2017_MODIS_NDVI_stats</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">folder</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GEE_SENAMHI</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">fileFormat</span><span class="p">:</span> <span class="dl">'</span><span class="s1">CSV</span><span class="dl">'</span>
<span class="p">});</span>

<span class="c1">// Y PULSE "RUN" EN LA PESTA칌A DE TAREAS EN EL PANEL SUPERIOR DERECHO</span></code></pre></figure>


Para ejecutar las tareas de exportar, debes ir a la pesta침a 'Tasks' en el panel superior derecho y presionar 'Run'.

<br>
<img src="../fig/03_runTask.png" border = "10" width="50%" height="50%">
<br><br>

### Exportar Images
Los usuarios pueden exportar los resultados de sus manipulaciones de im치genes a su carpeta de activos de GEE para su uso posterior dentro de la plataforma o a sus cuentas personales de Google Drive o de Google Cloud Storage. Aqu칤, exportaremos una imagen de una sola banda de NDVI m치ximo anual para nuestra cuenca. Se proporcionaran ejemplos para exportar a Google Drive. Se puede encontrar m치s informaci칩n sobre exportar
 [here in the Developers Guide](https://developers.google.com/earth-engine/exporting).

En la API de JavaScript, lo que se quiera exportar se env칤a a la pesta침a 'Tasks' en el panel superior derecho. Para evitar que los usuarios inunden el sistema inadvertidamente con tareas gratuitas y accidentales, es necesario ejecutar expl칤citamente la tarea individualmente desde la pesta침a 'Task'. Puede cambiar los nombres de los archivos y otros par치metros aqu칤, si es necesario, o codificarlos en su script.

Al exportar a Google Drive, GEE encontrar치 la carpeta con el nombre especificado y no necesita la ruta de archivo completa. Si esta carpeta a칰n no existe, la crear치 en tu unidad.



<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// La exportaci칩n es innecesaria, pero aqu칤 est치n los ejemplos de c칩digo para salvar un</span>
<span class="c1">// imagen compuesta si se desea.  </span>

<span class="c1">// seleccione s칩lo la banda de ndvi</span>
<span class="kd">var</span> <span class="nx">ndvi</span> <span class="o">=</span> <span class="nx">composite</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Ejemplo de exportaci칩n a Google Drive</span>
<span class="c1">// (nota: hay que pulsar 'Run' en la pesta침a de tareas en el panel superior derecho)</span>
<span class="nx">Export</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">toDrive</span><span class="p">({</span>
  <span class="na">image</span><span class="p">:</span> <span class="nx">ndvi</span><span class="p">,</span>
  <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENAMHI_2017_L8_NDVI_image</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">scale</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="na">region</span><span class="p">:</span> <span class="nx">watershed</span><span class="p">.</span><span class="nx">geometry</span><span class="p">().</span><span class="nx">bounds</span><span class="p">(),</span> <span class="c1">// .geometry().bounds() needed for multipolygon</span>
  <span class="na">crs</span><span class="p">:</span> <span class="dl">'</span><span class="s1">EPSG:5070</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">folder</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GEE_SENAMHI</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">maxPixels</span><span class="p">:</span> <span class="mi">2000000000</span>
<span class="p">});</span>

<span class="c1">// Ejemplo de exportaci칩n de una carpeta de assets</span>
<span class="c1">// (nota: hay que pulsar 'Run' en la pesta침a de tareas en el panel superior derecho)</span>
<span class="nx">Export</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">toAsset</span><span class="p">({</span>
  <span class="na">image</span><span class="p">:</span> <span class="nx">ndvi</span><span class="p">,</span>
  <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENAMHI_2017_L8_NDVI_image</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">assetId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">users/yourname/SENAMHI_2017_L8_NDVI_image</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">scale</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="na">region</span><span class="p">:</span> <span class="nx">watershed</span><span class="p">.</span><span class="nx">geometry</span><span class="p">().</span><span class="nx">bounds</span><span class="p">(),</span>
  <span class="na">pyramidingPolicy</span><span class="p">:</span> <span class="p">{</span><span class="dl">'</span><span class="s1">.default</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">mean</span><span class="dl">'</span><span class="p">},</span> <span class="c1">// use {'.default':'sample'} for discrete data</span>
  <span class="na">maxPixels</span><span class="p">:</span> <span class="mi">2000000000</span>
<span class="p">});</span></code></pre></figure>


Se puede acceder a una versi칩n est치tica del script aqu칤: [https://code.earthengine.google.com/8418ba2b48095a765720d79982bcfab7](https://code.earthengine.google.com/8418ba2b48095a765720d79982bcfab7)
-->
:ET